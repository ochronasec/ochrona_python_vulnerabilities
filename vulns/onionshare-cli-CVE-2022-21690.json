{
    "name": "onionshare-cli",
    "cve_id": "CVE-2022-21690",
    "publish_date": "2022-01-18T23:15Z",
    "cwe_id": "CWE-79",
    "owner": "Micah Lee",
    "affected_versions": [
        {
            "version_value": "2.5",
            "operator": "<"
        }
    ],
    "references": [
        "https://github.com/onionshare/onionshare/security/advisories/GHSA-ch22-x2v3-v6vq",
        "https://github.com/advisories/GHSA-ch22-x2v3-v6vq",
        "https://github.com/onionshare/onionshare/releases/tag/v2.5",
        "https://nvd.nist.gov/vuln/detail/CVE-2022-21690"
    ],
    "description": "From NVD:\nOnionShare is an open source tool that lets you securely and anonymously share files, host websites, and chat with friends using the Tor network. In affected versions The path parameter of the requested URL is not sanitized before being passed to the QT frontend. This path is used in all components for displaying the server access history. This leads to a rendered HTML4 Subset (QT RichText editor) in the Onionshare frontend.\nFrom Github:\nBetween September 26, 2021 and October 8, 2021, [Radically Open Security](https://www.radicallyopensecurity.com/) conducted a penetration test of OnionShare 2.4, funded by the Open Technology Fund's [Red Team lab](https://www.opentech.fund/labs/red-team-lab/). This is an issue from that penetration test.\n\n- Vulnerability ID: OTF-001\n- Vulnerability type: Improper Input Sanitization\n- Threat level: Elevated\n\n## Description:\n\nThe `path` parameter of the requested URL is not sanitized before being passed to the QT frontend.\n\n## Technical description:\n\nThe `path` parameter is not sanitized before being passed to the constructor of the `QLabel`.\n\nhttps://github.com/onionshare/onionshare/blob/d08d5f0f32f755f504494d80794886f346fbafdb/desktop/src/onionshare/tab/mode/__init__.py#L499-L509\n\nhttps://github.com/onionshare/onionshare/blob/d08d5f0f32f755f504494d80794886f346fbafdb/desktop/src/onionshare/tab/mode/history.py#L456-L483\n\nhttps://doc.qt.io/qt-5/qlabel.html#details\n\n> Warning: When passing a QString to the constructor or calling setText(), make sure to sanitize your input, as QLabel tries to guess whether it displays the text as plain text or as rich text, a subset of HTML 4 markup. You may want to call setTextFormat() explicitly, e.g. in case you expect the text to be in plain format but cannot control the text source (for instance when displaying data loaded from the Web).\n\nThis path is used in all components for displaying the server access history. This leads to a rendered HTML4 Subset (QT RichText editor) in the Onionshare frontend.\n\nIn the following example an adversary injects a crafted image file into an Onionshare instance with receive mode and renders it in the history component of the Onionshare application.\n\nThe only requirement is another visit to the shared site with the following parameter attached to the path of the URL:\n\n```\n<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAAFElEQVQY02Nk+M+ABzAxMIxKYwIAQC0BEwZFOw4AAAAASUVORK5CYII=' />\n```\n\nThis will be rendered as a green square in the history tab where the path value is supposed to be (the value itself is shown at the bottom of the page).\n\n![otf-001](https://user-images.githubusercontent.com/156128/140665358-ab9e5990-3e13-4e50-85fd-b8a6e323d299.png)\n\nPossible scenarios where this could lead to remote code execution would be a 0-day in libpng or other internal image rendering (OTF-014 (page 12)) of the QT framework.\n\nThe QT documentation indicates that external files could be rendered, but we were unable to find a QT code path allowing for it.\n\n## Impact:\n\nAn adversary with knowledge of the Onion service address in public mode or with authentication in private mode can render arbitrary HTML (QT-HTML4 Subset) in the server desktop application. This requires the desktop application with rendered history, therefore the impact is only elevated.\n\n## Recommendation:\n\n- Manually define the text format of the QLabel via `setTextFormat()`",
    "latest_version": "2.5",
    "language": "python",
    "license": "GPL-3.0-or-later",
    "repository_summary": "OnionShare lets you securely and anonymously send and receive files. It works by starting a web server, making it accessible as a Tor onion service, and generating an unguessable web address so others can download files from you, or upload files to you. It does _not_ require setting up a separate server or using a third party file-sharing service.",
    "repo_url": "https://github.com/onionshare/onionshare",
    "impact": {
        "cvss2_score": 3.5,
        "cvss2_severity": "LOW",
        "vector_string": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
        "av": "NETWORK",
        "ac": "LOW",
        "pr": "LOW",
        "c": "LOW",
        "i": "LOW",
        "a": "NONE",
        "impact_score": 2.7,
        "exploitability_score": 2.3,
        "cvss3_score": 5.4,
        "cvss3_severity": "MEDIUM",
        "ui": "REQUIRED",
        "s": "CHANGED"
    },
    "ochrona_severity_score": 5.4
}