{
    "name": "wagtail",
    "cve_id": "CVE-2021-29434",
    "publish_date": "2021-04-19T19:15Z",
    "cwe_id": "CWE-79",
    "owner": "Wagtail core team + contributors",
    "affected_versions": [
        {
            "version_value": "2.11.7",
            "operator": "<"
        },
        {
            "version_value": "2.12rc1",
            "operator": "="
        },
        {
            "version_value": "2.12",
            "operator": "="
        },
        {
            "version_value": "2.12.1",
            "operator": "="
        },
        {
            "version_value": "2.12.2",
            "operator": "="
        },
        {
            "version_value": "2.12.3",
            "operator": "="
        }
    ],
    "references": [
        "https://nvd.nist.gov/vuln/detail/CVE-2021-29434",
        "https://pypi.org/project/wagtail/",
        "https://github.com/advisories/GHSA-wq5h-f9p5-q7fx",
        "https://github.com/wagtail/wagtail/security/advisories/GHSA-wq5h-f9p5-q7fx"
    ],
    "description": "From NVD:\nWagtail is a Django content management system. In affected versions of Wagtail, when saving the contents of a rich text field in the admin interface, Wagtail does not apply server-side checks to ensure that link URLs use a valid protocol. A malicious user with access to the admin interface could thus craft a POST request to publish content with `javascript:` URLs containing arbitrary code. The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin. See referenced GitHub advisory for additional details, including a workaround. Patched versions have been released as Wagtail 2.11.7 (for the LTS 2.11 branch) and Wagtail 2.12.4 (for the current 2.12 branch).\nFrom Github:\n### Impact\nWhen saving the contents of a rich text field in the admin interface, Wagtail does not apply server-side checks to ensure that link URLs use a valid protocol. A malicious user with access to the admin interface could thus craft a POST request to publish content with `javascript:` URLs containing arbitrary code. The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin.\n\n### Patches\nPatched versions have been released as Wagtail 2.11.7 (for the LTS 2.11 branch) and Wagtail 2.12.4 (for the current 2.12 branch).\n\n### Workarounds\nFor sites that cannot easily upgrade to a current supported version, the vulnerability can be patched by adding the following code to a `wagtail_hooks.py` module in any installed app:\n\n```python\nfrom draftjs_exporter.dom import DOM\nfrom wagtail.admin.rich_text.converters.html_to_contentstate import ExternalLinkElementHandler, PageLinkElementHandler\nfrom wagtail.core import hooks\nfrom wagtail.core.whitelist import check_url\n\n\ndef link_entity(props):\n id_ = props.get('id')\n link_props = {}\n\n if id_ is not None:\n link_props['linktype'] = 'page'\n link_props['id'] = id_\n else:\n link_props['href'] = check_url(props.get('url'))\n\n return DOM.create_element('a', link_props, props['children'])\n\n\n@hooks.register('register_rich_text_features', order=1)\ndef register_link(features):\n features.register_converter_rule('contentstate', 'link', {\n 'from_database_format': {\n 'a[href]': ExternalLinkElementHandler('LINK'),\n 'a[linktype=\"page\"]': PageLinkElementHandler('LINK'),\n },\n 'to_database_format': {\n 'entity_decorators': {'LINK': link_entity}\n }\n })\n```\n\n### Acknowledgements\nMany thanks to Kevin Breen for reporting this issue.\n\n### For more information\nIf you have any questions or comments about this advisory:\n\n* Visit Wagtail's [support channels](https://docs.wagtail.io/en/stable/support.html)\n* Email us at security@wagtail.io (if you wish to send encrypted email, the public key ID is `0x6ba1e1a86e0f8ce8`)",
    "latest_version": "2.12.4",
    "language": "python",
    "license": "BSD-3-Clause",
    "repository_summary": "A Django content management system.",
    "repo_url": "https://github.com/wagtail/wagtail/",
    "impact": {
        "cvss2_score": null,
        "cvss2_severity": null,
        "av": "NETWORK",
        "ac": "LOW",
        "pr": "HIGH",
        "c": "HIGH",
        "i": "HIGH",
        "a": "NONW",
        "impact_score": 5.2,
        "exploitability_score": 0.9,
        "cvss3_score": 6.1,
        "cvss3_severity": "MEDIUM",
        "ui": "REQUIRED",
        "s": "UNCHANGED",
        "vector_string": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:U/C:H/I:H/A:N"
    },
    "ochrona_severity_score": 6.1
}